# Estándares de Código SQL - TaskFlow

## Formato de Indentación y Alineación

### 1. Definición de Tablas

#### Estructura Básica
```sql
create table table_name (
    column_name                     data_type                      constraint_type
  , another_column                  data_type             default value constraint_type
  , timestamp_column                timestamp with local time zone default localtimestamp not null
  , constraint constraint_name constraint_type (column_list)
);
```

#### Reglas de Alineación
- **Tipos de datos**: Alineados a la izquierda
- **`not null`**: Alineado a la derecha
- **`default`**: Alineado con sus valores
- **Comas**: Al final de las líneas
- **Indentación**: 2 espacios por nivel

#### Ejemplo Completo
```sql
create table core_unique_names (
    name_id                      number generated by default on null as identity (start with 1) primary key not null
  , entity_type                  varchar2(50 char)              not null
  , base_name                    varchar2(100 char)             not null
  , counter                      number             default 0   not null
  , last_used                    timestamp with local time zone default localtimestamp not null
  , active_yn                    varchar2(1 char)   default 'Y' not null
  , created_by                   varchar2(60 char)  default
                                  coalesce(
                                    sys_context('APEX$SESSION','app_user')
                                  , regexp_substr(sys_context('userenv','client_identifier'),'^[^:]*')
                                  , sys_context('userenv','session_user')
                                  )
                                  not null
  , created_on                   timestamp with local time zone default localtimestamp not null
  , last_updated_by              varchar2(60 char)
  , last_updated_on              timestamp with local time zone
  , constraint uk_core_unique_names_entity_base unique (entity_type, base_name)
  , constraint chk_core_unique_names_active_yn check (active_yn in ('Y', 'N'))
);
```

### 2. Packages

#### Package Specification
```sql
create or replace package package_name as
/*
  Package: package_name
  Description: Brief description
  Author: TaskFlow Team
  Date: YYYY
*/

  -- ========================================
  -- SECTION NAME
  -- ========================================

  function function_name(
    p_parameter_name                    in varchar2
  , p_another_parameter                 in number
  ) return varchar2;

end package_name;
/
```

#### Package Body
```sql
create or replace package body package_name as

  -- ========================================
  -- HELPER FUNCTIONS
  -- ========================================

  function helper_function(
    p_parameter_name                    in varchar2
  ) return varchar2
  is
    l_variable_name                     varchar2(100);
  begin
    -- Implementation
    return l_variable_name;
  end helper_function;

  -- ========================================
  -- MAIN FUNCTIONS
  -- ========================================

  function main_function(
    p_parameter_name                    in varchar2
  , p_another_parameter                 in number
  ) return varchar2
  is
    l_variable_name                     varchar2(100);
    l_another_variable                  number;
  begin
    -- Implementation
    return l_variable_name;
  end main_function;

end package_name;
/
```

### 3. Triggers

#### Estructura de Triggers
```sql
create or replace trigger trigger_name
before insert
on table_name
referencing old as old new as new
for each row
begin
  -- Trigger logic
  :new.column_name := function_call(
    :new.parameter_name
  , :new.another_parameter
  );
end;
/
```

### 4. Consultas INSERT

#### Formato Multi-línea
```sql
insert into table_name (
    column_name
  , another_column
  , third_column
) values (
    'value1'
  , 'value2'
  , 'value3'
);
```

### 5. Consultas UPDATE

#### Formato con SET y WHERE
```sql
update table_name 
   set column_name = 'new_value'
     , another_column = 'another_value'
 where condition_column = 'condition_value';
```

### 6. Llamadas a Funciones

#### Parámetros en Líneas Separadas
```sql
result := function_name(
    'parameter1'
  , 'parameter2'
  , 123
);
```

### 7. Comentarios

#### Comentarios de Tabla
```sql
-- Comments
comment on table table_name is 'Description of the table';
comment on column table_name.column_name is 'Description of the column';
```

#### Comentarios de Package
```sql
/*
  Package: package_name
  Description: Detailed description of the package
  Author: TaskFlow Team
  Date: YYYY
*/
```

### 8. Convenciones de Nomenclatura

#### Tablas
- **Prefijo**: `core_` para tablas del sistema
- **Formato**: `core_entity_name`
- **Ejemplo**: `core_users`, `core_unique_names`

#### Packages
- **Formato**: `core_entity_manager`
- **Ejemplo**: `core_unique_name_manager`

#### Triggers
- **Formato**: `table_name_action_trg`
- **Ejemplo**: `core_users_bi_trg` (before insert)

#### Constraints
- **Unique**: `uk_table_column`
- **Foreign Key**: `fk_table_reference`
- **Check**: `chk_table_column`

### 9. Características Especiales

#### Manejo de Contexto de Usuario
```sql
created_by                   varchar2(60 char)  default
                              coalesce(
                                sys_context('APEX$SESSION','app_user')
                              , regexp_substr(sys_context('userenv','client_identifier'),'^[^:]*')
                              , sys_context('userenv','session_user')
                              )
                              not null
```

#### Timestamps
```sql
created_on                   timestamp with local time zone default localtimestamp not null
last_updated_on              timestamp with local time zone
```

### 10. Validaciones

#### Check Constraints
```sql
constraint chk_table_active_yn check (active_yn in ('Y', 'N'))
```

---

**Nota**: Este documento debe ser referenciado al inicio de cada sesión de desarrollo para mantener consistencia en el formato del código.
